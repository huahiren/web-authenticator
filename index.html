<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态二维码验证器</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="jsqr.min.js"></script>
</head>
<body>
    <!-- 登录页面 -->
    <div id="login-page" class="container">
        <div class="login-form">
            <h1>Google身份验证器</h1>
            <p>Web版本</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">用户名</label>
                    <input type="text" id="login-username" name="username" placeholder="输入用户名" required>
                </div>
                <div class="form-group">
                    <label for="login-password">密码</label>
                    <input type="password" id="login-password" name="password" placeholder="输入密码" required>
                </div>
                <button type="submit" class="btn btn-primary">登录</button>
                <p id="login-message"></p>
            </form>
        </div>
    </div>

    <!-- 主应用页面 -->
    <div id="app-page" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>Google Authenticator</h1>
                    <p>Web版本</p>
                </div>
                <div class="user-info">
                    <span id="current-user"></span>
                    <button id="user-settings-btn" class="btn btn-secondary">设置</button>
                    <button id="logout-btn" class="btn btn-secondary">退出登录</button>
                </div>
            </div>
        </header>

        <main>
            <div class="admin-dashboard">
            <!-- 左侧Tab导航 -->
            <div class="tab-sidebar">
                <button class="tab-btn active" data-tab="my-accounts">我的账户</button>
                <button class="tab-btn" data-tab="add-account-section">添加账户</button>
                <button class="tab-btn" data-tab="user-management">用户管理</button>
            </div>
            
            <!-- Tab内容区域 -->
            <div class="tab-content-area">
                <!-- 我的账户Tab内容 -->
                <div id="my-accounts" class="tab-content active">
                    <div class="section-header">
                        <h2>我的账户</h2>
                    </div>
                    <div class="section-content">
                        <div id="accounts-list"></div>
                    </div>
                </div>

                <!-- 添加账户Tab内容 -->
                <div id="add-account-section" class="tab-content">
                    <div class="section-header">
                        <h2>添加账户</h2>
                    </div>
                    <div class="section-content">
                        <form id="add-account-form">
                            <div class="form-group">
                                <label for="account-name">账户名称</label>
                                <input type="text" id="account-name" name="name" placeholder="例如：example@gmail.com" required>
                            </div>
                            <div class="form-group">
                                <label for="account-issuer">发行者（可选）</label>
                                <input type="text" id="account-issuer" name="issuer" placeholder="例如：Google">
                            </div>
                            <div class="form-group">
                                <label for="account-secret">密钥</label>
                                <div class="secret-input-group">
                                    <input type="text" id="account-secret" name="secret" placeholder="输入32位Base32密钥" required>
                                </div>
                            </div>
                            <div class="add-account-buttons">
                                <button type="button" id="generate-secret" class="btn btn-secondary">生成随机密钥</button>
                                <button type="button" id="scan-qr-btn" class="btn btn-secondary">扫描二维码</button>
                                <button type="submit" class="btn btn-primary">添加账户</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 用户管理Tab内容 -->
                <div id="user-management" class="tab-content">
                    <div class="section-header">
                        <h2>用户管理</h2>
                    </div>
                    <div class="section-content">
                        <form id="add-user-form">
                            <div class="form-group">
                                <label for="new-username">新用户名</label>
                                <input type="text" id="new-username" name="username" placeholder="输入用户名" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">密码</label>
                                <input type="password" id="new-password" name="password" placeholder="输入密码" required>
                            </div>
                            <div class="form-group">
                                <label for="user-role">角色</label>
                                <select id="user-role" name="role">
                                    <option value="admin">管理员</option>
                                    <option value="user">普通用户</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">添加用户</button>
                        </form>
                        
                        <div id="users-list" class="users-list"></div>
                    </div>
                </div>
            </div>
        </div>
        </main>

        <footer>
            <p>&copy; 2023 Google Authenticator Web</p>
        </footer>
    </div>

    <!-- 二维码扫描模态框 -->
    <div id="qr-scan-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>二维码扫描</h3>
            
            <!-- 扫描方式切换 -->
            <div class="scan-tabs">
                <button class="tab-btn active" data-tab="camera">摄像头扫描</button>
                <button class="tab-btn" data-tab="image">图片扫描</button>
            </div>
            
            <!-- 摄像头扫描内容 -->
            <div id="camera-scan" class="scan-content active">
                <div class="scan-preview-container">
                    <video id="scan-preview" autoplay playsinline></video>
                    <div class="scan-overlay">
                        <div class="scan-line"></div>
                    </div>
                </div>
                <div class="scan-controls">
                    <button id="start-scan" class="btn btn-primary">开始扫描</button>
                    <button id="stop-scan" class="btn btn-secondary" disabled>停止扫描</button>
                </div>
            </div>
            
            <!-- 图片扫描内容 -->
            <div id="image-scan" class="scan-content">
                <div class="image-preview-container">
                    <div class="image-preview" id="image-drop-zone">
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                        <div class="image-placeholder">
                            <p>点击选择图片或拖拽图片到此处</p>
                            <button id="select-image-btn" class="btn btn-secondary">选择图片</button>
                        </div>
                        <img id="image-preview" src="" alt="图片预览">
                    </div>
                </div>
                <div class="scan-controls">
                    <button id="reset-image" class="btn btn-secondary" disabled>重置</button>
                    <button id="decode-image" class="btn btn-primary">解析二维码</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 二维码显示模态框 -->
    <div id="show-qr-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>二维码</h3>
            <div id="show-qr-container" style="display: flex; justify-content: center; align-items: center; padding: 20px;"></div>
        </div>
    </div>

    <!-- 用户设置模态框 -->
    <div id="user-settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>用户设置</h3>
            <form id="change-password-form">
                <div class="form-group">
                    <label for="current-password">当前密码</label>
                    <input type="password" id="current-password" name="currentPassword" required>
                </div>
                <div class="form-group">
                    <label for="new-password">新密码</label>
                    <input type="password" id="new-password-setting" name="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password">确认新密码</label>
                    <input type="password" id="confirm-password" name="confirmPassword" required>
                </div>
                <div id="password-message"></div>
                <button type="submit" class="btn btn-primary">修改密码</button>
            </form>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="script.js"></script>
</body>
</html>